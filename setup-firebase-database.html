<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sitara777 Firebase Database Setup</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .setup-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }

        .setup-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .setup-section p {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
            font-weight: 600;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
        }

        .status.success {
            background: rgba(76, 175, 80, 0.1);
            color: #2e7d32;
            border: 1px solid #4caf50;
        }

        .status.error {
            background: rgba(244, 67, 54, 0.1);
            color: #c62828;
            border: 1px solid #f44336;
        }

        .status.info {
            background: rgba(33, 150, 243, 0.1);
            color: #1565c0;
            border: 1px solid #2196f3;
        }

        .console {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
            border: 1px solid #333;
        }

        .console-line {
            margin-bottom: 5px;
        }

        .step-list {
            list-style: none;
            padding: 0;
        }

        .step-list li {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }

        .step-list li:before {
            content: "‚úì";
            color: #4caf50;
            font-weight: bold;
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .step-list li.pending:before {
            content: "‚óã";
            color: #999;
        }

        .firebase-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .firebase-link {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            text-decoration: none;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .firebase-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Sitara777 Firebase Database Setup</h1>
            <p>Initialize your Firebase database with the complete structure for your Satka Matka admin panel</p>
        </div>

        <div class="setup-section">
            <h3>üìã Database Structure Overview</h3>
            <p>This setup will create the following collections in your Firebase database:</p>
            <ul class="step-list">
                <li>üë• Users Collection (user management)</li>
                <li>üè™ Bazaars Collection (game settings)</li>
                <li>üéØ Game Results Collection (results management)</li>
                <li>üí∞ Transactions Collection (financial tracking)</li>
                <li>üí≥ Withdrawals Collection (withdrawal management)</li>
                <li>üì¢ Notifications Collection (push notifications)</li>
                <li>‚öôÔ∏è Settings Collection (system configuration)</li>
                <li>üìä Analytics Collection (performance tracking)</li>
                <li>üîê Admin Users Collection (admin management)</li>
            </ul>
        </div>

        <div class="setup-section">
            <h3>üîß Setup Process</h3>
            <p>Click the button below to initialize your Firebase database with sample data:</p>
            <button id="initBtn" class="btn">üöÄ Initialize Database</button>
            <button id="indexBtn" class="btn">üìã Show Index Instructions</button>
            <button id="rulesBtn" class="btn">üîí Show Security Rules</button>
            
            <div id="status" class="status" style="display: none;"></div>
        </div>

        <div class="setup-section">
            <h3>üåê Firebase Console Links</h3>
            <div class="firebase-links">
                <a href="https://console.firebase.google.com/project/sitara777admin/database/sitara777admin-default-rtdb/data/~2F" target="_blank" class="firebase-link">
                    üìä Realtime Database
                </a>
                <a href="https://console.firebase.google.com/project/sitara777admin/firestore/data" target="_blank" class="firebase-link">
                    üî• Firestore Database
                </a>
                <a href="https://console.firebase.google.com/project/sitara777admin/firestore/indexes" target="_blank" class="firebase-link">
                    üìã Database Indexes
                </a>
                <a href="https://console.firebase.google.com/project/sitara777admin/firestore/rules" target="_blank" class="firebase-link">
                    üîí Security Rules
                </a>
            </div>
        </div>

        <div class="setup-section">
            <h3>üìù Console Output</h3>
            <div id="console" class="console">
                <div class="console-line">> Ready to initialize Sitara777 Firebase database...</div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, setDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCTnn-lImPW0tXooIMVkzWQXBoOKN9yNbw",
            authDomain: "sitara777admin.firebaseapp.com",
            projectId: "sitara777admin",
            storageBucket: "sitara777admin.firebasestorage.app",
            messagingSenderId: "211927307499",
            appId: "1:211927307499:web:65cdd616f9712b203cdaae",
            measurementId: "G-RB5C24JE55"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Sample data
        const sampleData = {
            adminUsers: {
                "admin_sitara777": {
                    username: "Sitara777",
                    email: "admin@sitara777.com",
                    role: "super_admin",
                    permissions: {
                        users: ["view", "edit", "delete"],
                        results: ["view", "create", "edit", "delete"],
                        withdrawals: ["view", "approve", "reject"],
                        transactions: ["view", "create"],
                        notifications: ["view", "create", "send"],
                        settings: ["view", "edit"]
                    },
                    status: "active",
                    lastLogin: new Date(),
                    createdAt: new Date(),
                    createdBy: "system"
                }
            },
            bazaars: {
                "bazaar_sitara777": {
                    name: "Sitara777",
                    status: "open",
                    openTime: "09:00",
                    closeTime: "23:00",
                    resultTime: "23:30",
                    minBet: 10,
                    maxBet: 10000,
                    commission: 5.0,
                    createdAt: new Date(),
                    updatedAt: new Date(),
                    description: "Main Sitara777 bazaar",
                    isActive: true
                }
            },
            settings: {
                general: {
                    siteName: "Sitara777",
                    siteDescription: "Professional Satka Matka Management System",
                    maintenanceMode: false,
                    maintenanceMessage: "Site under maintenance",
                    defaultCurrency: "INR",
                    timezone: "Asia/Kolkata"
                },
                bazaar: {
                    defaultOpenTime: "09:00",
                    defaultCloseTime: "23:00",
                    defaultResultTime: "23:30",
                    defaultMinBet: 10,
                    defaultMaxBet: 10000,
                    defaultCommission: 5.0
                },
                withdrawal: {
                    minAmount: 100,
                    maxAmount: 50000,
                    processingTime: "24",
                    autoApprove: false,
                    requiredDocuments: ["aadhar", "pan"]
                },
                notifications: {
                    pushEnabled: true,
                    emailEnabled: true,
                    smsEnabled: false
                }
            },
            users: {
                "user_demo1": {
                    username: "demo_user1",
                    phone: "+919876543210",
                    email: "demo1@example.com",
                    balance: 5000,
                    status: "active",
                    createdAt: new Date(),
                    lastLogin: new Date(),
                    totalBets: 50,
                    totalWinnings: 15000,
                    referralCode: "REF001",
                    kycStatus: "verified",
                    kycDocuments: {
                        aadhar: "123456789012",
                        pan: "ABCDE1234F"
                    }
                },
                "user_demo2": {
                    username: "demo_user2",
                    phone: "+919876543211",
                    email: "demo2@example.com",
                    balance: 3000,
                    status: "active",
                    createdAt: new Date(),
                    lastLogin: new Date(),
                    totalBets: 30,
                    totalWinnings: 8000,
                    referralCode: "REF002",
                    kycStatus: "pending",
                    kycDocuments: {
                        aadhar: "123456789013",
                        pan: "ABCDE1235F"
                    }
                }
            },
            gameResults: {
                "result_2024_01_20": {
                    bazaarId: "bazaar_sitara777",
                    bazaarName: "Sitara777",
                    date: "2024-01-20",
                    openTime: "09:00",
                    closeTime: "23:00",
                    resultTime: "23:30",
                    openNumber: 123,
                    closeNumber: 456,
                    openPatti: "1+2+3=6",
                    closePatti: "4+5+6=15",
                    openJodi: "12",
                    closeJodi: "45",
                    status: "published",
                    createdBy: "admin_sitara777",
                    createdAt: new Date(),
                    updatedAt: new Date(),
                    totalBets: 150,
                    totalAmount: 7500,
                    totalPayout: 4500
                }
            },
            transactions: {
                "txn_001": {
                    userId: "user_demo1",
                    username: "demo_user1",
                    type: "deposit",
                    amount: 1000,
                    balanceBefore: 4000,
                    balanceAfter: 5000,
                    status: "completed",
                    description: "Wallet recharge",
                    reference: "TXN001",
                    createdAt: new Date(),
                    updatedAt: new Date(),
                    adminId: "admin_sitara777",
                    adminNote: "Manual credit by admin"
                },
                "txn_002": {
                    userId: "user_demo2",
                    username: "demo_user2",
                    type: "withdrawal",
                    amount: 500,
                    balanceBefore: 3500,
                    balanceAfter: 3000,
                    status: "completed",
                    description: "Withdrawal processed",
                    reference: "TXN002",
                    createdAt: new Date(),
                    updatedAt: new Date(),
                    adminId: "admin_sitara777",
                    adminNote: "Withdrawal approved"
                }
            },
            withdrawals: {
                "withdrawal_001": {
                    userId: "user_demo1",
                    username: "demo_user1",
                    amount: 2000,
                    requestedAmount: 2000,
                    approvedAmount: 2000,
                    status: "approved",
                    paymentMethod: "bank_transfer",
                    accountDetails: {
                        accountNumber: "1234567890",
                        ifscCode: "SBIN0001234",
                        accountHolder: "Demo User 1"
                    },
                    requestedAt: new Date(),
                    processedAt: new Date(),
                    processedBy: "admin_sitara777",
                    adminNote: "Payment processed successfully",
                    userNote: "Need money for emergency"
                }
            },
            notifications: {
                "notif_001": {
                    title: "Welcome to Sitara777",
                    message: "Welcome to Sitara777! Your account has been successfully created.",
                    type: "general",
                    targetUsers: "all",
                    status: "sent",
                    sentAt: new Date(),
                    createdBy: "admin_sitara777",
                    createdAt: new Date(),
                    readBy: ["user_demo1"],
                    clickedBy: ["user_demo1"]
                }
            }
        };

        // Console logging function
        function logToConsole(message, type = 'info') {
            const console = document.getElementById('console');
            const line = document.createElement('div');
            line.className = 'console-line';
            
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
            
            line.innerHTML = `<span style="color: #888;">[${timestamp}]</span> ${icon} ${message}`;
            console.appendChild(line);
            console.scrollTop = console.scrollHeight;
        }

        // Status update function
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
        }

        // Initialize database function
        async function initializeDatabase() {
            try {
                logToConsole('üöÄ Starting Firebase database initialization for Sitara777...');
                updateStatus('Initializing database...', 'info');

                // Initialize Admin Users
                logToConsole('üìù Setting up admin users...');
                for (const [userId, userData] of Object.entries(sampleData.adminUsers)) {
                    await setDoc(doc(db, 'adminUsers', userId), {
                        ...userData,
                        createdAt: serverTimestamp(),
                        lastLogin: serverTimestamp()
                    });
                }

                // Initialize Bazaars
                logToConsole('üè™ Setting up bazaars...');
                for (const [bazaarId, bazaarData] of Object.entries(sampleData.bazaars)) {
                    await setDoc(doc(db, 'bazaars', bazaarId), {
                        ...bazaarData,
                        createdAt: serverTimestamp(),
                        updatedAt: serverTimestamp()
                    });
                }

                // Initialize Settings
                logToConsole('‚öôÔ∏è Setting up settings...');
                await setDoc(doc(db, 'settings', 'general'), sampleData.settings.general);
                await setDoc(doc(db, 'settings', 'bazaar'), sampleData.settings.bazaar);
                await setDoc(doc(db, 'settings', 'withdrawal'), sampleData.settings.withdrawal);
                await setDoc(doc(db, 'settings', 'notifications'), sampleData.settings.notifications);

                // Initialize Users
                logToConsole('üë• Setting up sample users...');
                for (const [userId, userData] of Object.entries(sampleData.users)) {
                    await setDoc(doc(db, 'users', userId), {
                        ...userData,
                        createdAt: serverTimestamp(),
                        lastLogin: serverTimestamp()
                    });
                }

                // Initialize Game Results
                logToConsole('üéØ Setting up sample game results...');
                for (const [resultId, resultData] of Object.entries(sampleData.gameResults)) {
                    await setDoc(doc(db, 'gameResults', resultId), {
                        ...resultData,
                        createdAt: serverTimestamp(),
                        updatedAt: serverTimestamp()
                    });
                }

                // Initialize Transactions
                logToConsole('üí∞ Setting up sample transactions...');
                for (const [txnId, txnData] of Object.entries(sampleData.transactions)) {
                    await setDoc(doc(db, 'transactions', txnId), {
                        ...txnData,
                        createdAt: serverTimestamp(),
                        updatedAt: serverTimestamp()
                    });
                }

                // Initialize Withdrawals
                logToConsole('üí≥ Setting up sample withdrawals...');
                for (const [withdrawalId, withdrawalData] of Object.entries(sampleData.withdrawals)) {
                    await setDoc(doc(db, 'withdrawals', withdrawalId), {
                        ...withdrawalData,
                        requestedAt: serverTimestamp(),
                        processedAt: serverTimestamp()
                    });
                }

                // Initialize Notifications
                logToConsole('üì¢ Setting up sample notifications...');
                for (const [notifId, notifData] of Object.entries(sampleData.notifications)) {
                    await setDoc(doc(db, 'notifications', notifId), {
                        ...notifData,
                        sentAt: serverTimestamp(),
                        createdAt: serverTimestamp()
                    });
                }

                logToConsole('‚úÖ Firebase database initialization completed successfully!');
                logToConsole('üìä Database structure created with sample data');
                logToConsole('üîó You can now view your data in Firebase Console');
                logToConsole('üåê Firebase Console URL: https://console.firebase.google.com/project/sitara777admin');
                
                updateStatus('Database initialization completed successfully!', 'success');

            } catch (error) {
                logToConsole(`‚ùå Error initializing database: ${error.message}`, 'error');
                updateStatus(`Error: ${error.message}`, 'error');
            }
        }

        // Event listeners
        document.getElementById('initBtn').addEventListener('click', initializeDatabase);
        
        document.getElementById('indexBtn').addEventListener('click', () => {
            logToConsole('üìã Manual Index Creation Required:');
            logToConsole('1. Go to Firebase Console > Firestore Database > Indexes');
            logToConsole('2. Create the following composite indexes:');
            logToConsole('');
            logToConsole('Collection: bets');
            logToConsole('- userId (Ascending) + date (Ascending)');
            logToConsole('- bazaarId (Ascending) + date (Ascending)');
            logToConsole('- status (Ascending) + createdAt (Descending)');
            logToConsole('');
            logToConsole('Collection: gameResults');
            logToConsole('- bazaarId (Ascending) + date (Descending)');
            logToConsole('- status (Ascending) + createdAt (Descending)');
            logToConsole('');
            logToConsole('Collection: transactions');
            logToConsole('- userId (Ascending) + createdAt (Descending)');
            logToConsole('- type (Ascending) + createdAt (Descending)');
            logToConsole('');
            logToConsole('Collection: withdrawals');
            logToConsole('- userId (Ascending) + createdAt (Descending)');
            logToConsole('- status (Ascending) + createdAt (Descending)');
        });
        
        document.getElementById('rulesBtn').addEventListener('click', () => {
            logToConsole('üîí Security Rules Setup:');
            logToConsole('1. Go to Firebase Console > Firestore Database > Rules');
            logToConsole('2. Replace the existing rules with the following:');
            logToConsole('');
            logToConsole('rules_version = \'2\';');
            logToConsole('service cloud.firestore {');
            logToConsole('  match /databases/{database}/documents {');
            logToConsole('    // Admin users can read all documents');
            logToConsole('    match /{document=**} {');
            logToConsole('      allow read, write: if request.auth != null &&');
            logToConsole('        get(/databases/$(database)/documents/adminUsers/$(request.auth.uid)).data.role == \'super_admin\';');
            logToConsole('    }');
            logToConsole('    // ... (see FIREBASE_DATABASE_STRUCTURE.md for complete rules)');
            logToConsole('  }');
            logToConsole('}');
        });

        // Initial console message
        logToConsole('> Ready to initialize Sitara777 Firebase database...');
    </script>
</body>
</html> 